<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ユーザ一覧</title>

  <style>
    
/* === filter.css === */
thead tr:nth-child(2) th {
    padding-top: 2px;
    padding-bottom: 2px;
}
.filter-input {
    width: 60px;
    margin: 2px;
}

/* === sort.css === */
.sort-btn {
    border: none;
    background: none;
    cursor: pointer;
    font-size: 0.8em;
    margin-left: 5px;
    padding: 0;
}
th {
    vertical-align: bottom;
}
/* === table.css === */
table {
    border-collapse: collapse;
    width: 100%;
}
th, td {
    border: 1px solid #ccc;
    padding: 4px 8px;
    text-align: left;
}

  </style>

  <script>
    
// === table.js ===
document.addEventListener("DOMContentLoaded", () => {
  const table = document.getElementById("data-table");
  const tbody = table.querySelector("tbody");

  // --- 元データを配列に保持 ---
  const originalRows = Array.from(tbody.querySelectorAll("tr")).map(tr => ({
    element: tr,
    // 各行のセル値を配列で保持
    cells: Array.from(tr.querySelectorAll("td")).map(td => td.textContent.trim()),
    index: Number(tr.dataset.originalIndex) // 元の並び順を記録
  }));

  // --- 列名 → インデックスのマッピング（最初のヘッダー行のみ） ---
  const firstHeaderRow = table.querySelector("thead tr:first-child");
  const colMap = {};
  Array.from(firstHeaderRow.querySelectorAll("th")).forEach((th, i) => {
    const key = th.dataset.key;
    if (key) colMap[key] = i;
  });

  // --- ソート状態の管理 ---
  const sortStates = {};
  table.querySelectorAll(".sort-btn").forEach(btn => {
    const key = btn.dataset.key;
    sortStates[key] = "none"; // 初期はソート無し

    btn.addEventListener("click", () => {
      // ソート状態を循環: none → asc → desc → none
      sortStates[key] =
        sortStates[key] === "none" ? "asc" :
        sortStates[key] === "asc" ? "desc" : "none";

      // 他の列のソート状態はリセット
      Object.keys(sortStates).forEach(k => {
        if (k !== key) sortStates[k] = "none";
      });

      // ボタン表示を更新
      table.querySelectorAll(".sort-btn").forEach(b => {
        const k = b.dataset.key;
        b.textContent =
          sortStates[k] === "none" ? "△▽" :
          sortStates[k] === "asc" ? "▲▽" : "△▼";
      });

      render();
    });
  });

  // --- フィルター状態の管理 ---
  const filters = {};
  Array.from(table.querySelectorAll(".filter-input")).forEach(input => {
    const key = input.dataset.key;
    if (!filters[key]) filters[key] = { min: null, max: null, select: null };

    // 入力・変更イベントで更新
    input.addEventListener("input", updateFilters);
    input.addEventListener("change", updateFilters);
  });

  // --- フィルター更新関数 ---
  function updateFilters() {
    Array.from(table.querySelectorAll(".filter-input")).forEach(input => {
      const key = input.dataset.key;
      const type = input.dataset.type || "select";
      filters[key][type] = input.value.trim() || null;
    });
    render();
  }

  // --- 行がフィルターを通るか判定 ---
  const passesFilter = row => Object.keys(filters).every(colKey => {
    const i = colMap[colKey];
    const val = row.cells[i];
    const f = filters[colKey];
    return (
      (!f.select || val === f.select) &&
      (!f.min || Number(val) >= Number(f.min)) &&
      (!f.max || Number(val) <= Number(f.max))
    );
  });

  // --- 行比較関数（ソート用） ---
  function compare(rowA, rowB) {
    const sortCol = Object.keys(sortStates).find(k => sortStates[k] !== "none");
    if (!sortCol) return rowA.index - rowB.index; // ソート無しは元の順

    const order = sortStates[sortCol];
    const i = colMap[sortCol];
    const a = rowA.cells[i];
    const b = rowB.cells[i];

    // 数値ソート・文字列ソートを自動判定
    const na = parseFloat(a);
    const nb = parseFloat(b);
    const bothNumeric = !isNaN(na) && !isNaN(nb);

    if (bothNumeric) return order === "asc" ? na - nb : nb - na;
    return order === "asc" ? a.localeCompare(b) : b.localeCompare(a);
  }

  // --- テーブル描画関数 ---
  function render() {
    // フィルターを通した後にソート
    const rows = originalRows
      .filter(passesFilter)
      .sort(compare);

    // tbody を再描画
    tbody.innerHTML = "";
    rows.forEach(r => tbody.appendChild(r.element));
  }
});

  </script>
</head>
<body>
  <header>
    <h1>ユーザ一覧</h1>
  </header>

  <main>
    

<table id="data-table">
  <thead>
    <!-- ヘッダー行: 列名＋ソートボタン -->
    <tr>
      
      <th data-key="name">
        名前
        <button class="sort-btn" data-key="name">△▽</button>
      </th>
      
      <th data-key="age">
        年齢
        <button class="sort-btn" data-key="age">△▽</button>
      </th>
      
      <th data-key="city">
        都市
        <button class="sort-btn" data-key="city">△▽</button>
      </th>
      
    </tr>

    <!-- フィルター行 -->
    <tr>
      
      <th>
        
        <select class="filter-input" data-key="name">
          <option value="">すべて</option>
          
          <option value="satou">satou</option>
          
          <option value="suzuki">suzuki</option>
          
          <option value="takaashigani">takaashigani</option>
          
          <option value="takahashi">takahashi</option>
          
          <option value="tanaka">tanaka</option>
          
        </select>
        
      </th>
      
      <th>
        
        <input type="number" class="filter-input" placeholder="min" data-key="age" data-type="min">
        <input type="number" class="filter-input" placeholder="max" data-key="age" data-type="max">
        
      </th>
      
      <th>
        
        <select class="filter-input" data-key="city">
          <option value="">すべて</option>
          
          <option value="nagoya">nagoya</option>
          
          <option value="osaka">osaka</option>
          
          <option value="suruga">suruga</option>
          
          <option value="tokyo">tokyo</option>
          
        </select>
        
      </th>
      
    </tr>
  </thead>

  <tbody>
    
    <tr data-original-index="0">
      
      <td>tanaka</td>
      
      <td>28</td>
      
      <td>tokyo</td>
      
    </tr>
    
    <tr data-original-index="1">
      
      <td>takahashi</td>
      
      <td>40</td>
      
      <td>osaka</td>
      
    </tr>
    
    <tr data-original-index="2">
      
      <td>satou</td>
      
      <td>34</td>
      
      <td>osaka</td>
      
    </tr>
    
    <tr data-original-index="3">
      
      <td>suzuki</td>
      
      <td>22</td>
      
      <td>nagoya</td>
      
    </tr>
    
    <tr data-original-index="4">
      
      <td>takahashi</td>
      
      <td>29</td>
      
      <td>tokyo</td>
      
    </tr>
    
    <tr data-original-index="5">
      
      <td>takaashigani</td>
      
      <td>100</td>
      
      <td>suruga</td>
      
    </tr>
    
  </tbody>
</table>


  </main>
</body>
</html>